trigger:
  branches:
    include:
    - '*'
jobs:
- job: sanity_checks
  timeoutInMinutes: 120
  pool:
    vmImage: 'windows-latest'
  steps:
  - task: CredScan@3
    displayName: 'Credscan'
    inputs:
      outputFormat: sarif
      debugMode: false
  - task: PowerShell@2
    inputs:
      targetType: 'inline'
      script: 'bazelisk build -c dbg //src/cc/lib:wrapper --config=windows'
  - task: onebranch.pipeline.signing@1
      inputs:
        command: 'sign'
        signing_profile: 'external_distribution'
        files_to_sign: '**/*.exe;**/*.dll'
        search_root: '$(Build.BinariesDirectory)\RelWithDebInfo\RelWithDebInfo'
      displayName: 'Sign runtime DLLs'
  - task: BinSkim@4
    inputs:
       toolVersion: Latest
       InputType:   CommandLine
       arguments:   analyze bazel-bin/src/cc/lib/*.dll --recurse
